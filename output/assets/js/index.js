class Task {
  constructor(content) {
    this.content = content;
    this.isCompleted = false;
  }

}

class ToDoList {
  constructor(tasksContainer) {
    this.tasksContainer = tasksContainer;
    this.tasks = JSON.parse(localStorage.getItem('tasks')) || [];
    this._activeTasks = [];
    this._completedTasks = [];
    this.bindAddTaskButton();
    this.createTasksFilters();
    this.createTasksList(this.tasks);
  }

  get activeTasks() {
    this._activeTasks = this.tasks.filter(task => task.isCompleted === false);
    return this._activeTasks;
  }

  get completedTasks() {
    this._completedTasks = this.tasks.filter(task => task.isCompleted === true);
    return this._completedTasks;
  }

  bindAddTaskButton() {
    const button = document.getElementById('todo-button-add');
    const input = document.getElementById('todo-input');
    input.addEventListener('keyup', e => {
      if (e.key === 'Enter') {
        this.saveTask(input.value);
        input.value = '';
      }
    });
    button.addEventListener('click', () => {
      this.saveTask(input.value);
      input.value = '';
    });
  }

  saveTask(content) {
    if (content !== '') {
      const task = new Task(content);
      this.tasks.unshift(task);
      this.addToLocalStorage();
      this.createTasksList(this.tasks);
      return;
    }

    alert('Type something!');
  }

  createTasksList(tasksArray) {
    this.createActiveTaskCounter();
    this.tasksContainer.innerHTML = '';
    tasksArray.forEach((task, taskIndex) => {
      const taskItem = document.createElement('li');
      const taskContent = document.createElement('span');
      const taskActions = document.createElement('div');
      const doneButton = document.createElement('button');
      const doneTaskClass = 'todo-item-completed';
      const removeButton = document.createElement('button');
      taskItem.classList.add('todo-item');
      taskContent.classList.add('todo-item-content');
      taskActions.classList.add('todo-item-actions');
      taskContent.innerHTML = task.content;
      doneButton.setAttribute('class', 'todo-task-button todo-done-button');
      doneButton.innerHTML = 'Done';
      doneButton.addEventListener('click', e => {
        e.currentTarget.parentNode.parentNode.classList.add(doneTaskClass);
        taskActions.removeChild(doneButton);
        task.isCompleted = true;
        this.addToLocalStorage();
        this.createTasksList(this.tasks);
      });
      removeButton.setAttribute('class', 'todo-task-button todo-remove-button');
      removeButton.innerHTML = 'Delete';
      removeButton.addEventListener('click', () => {
        this.tasksContainer.removeChild(taskItem);
        this.tasks.splice(taskIndex, 1);
        this.addToLocalStorage();
        this.createTasksList(this.tasks);
      });

      if (task.isCompleted) {
        taskItem.classList.add(doneTaskClass);
        taskActions.append(removeButton);
      }

      if (!task.isCompleted) {
        taskActions.append(doneButton, removeButton);
      }

      taskItem.append(taskContent, taskActions);
      this.tasksContainer.append(taskItem);
    });
  }

  createTasksFilters() {
    const showAll = document.getElementById('todo-show-all');
    const showActive = document.getElementById('todo-show-active');
    const showCompleted = document.getElementById('todo-show-completed');
    const clearCompleted = document.getElementById('todo-clear-completed');
    showAll.addEventListener('click', e => {
      e.preventDefault();
      this.createTasksList(this.tasks);
    });
    showActive.addEventListener('click', e => {
      e.preventDefault();
      this.createTasksList(this.activeTasks);
    });
    showCompleted.addEventListener('click', e => {
      e.preventDefault();
      this.createTasksList(this.completedTasks);
    });
    clearCompleted.addEventListener('click', e => {
      e.preventDefault();

      if (this.completedTasks.length) {
        this.completedTasks.forEach(completedTask => {
          this.tasks.splice(this.tasks.findIndex(task => task.content === completedTask.content), 1);
        });
        this.addToLocalStorage();
        this.createTasksList(this.tasks);
        return;
      }

      alert('All tasks have active status!');
    });
  }

  addToLocalStorage() {
    localStorage.setItem('tasks', JSON.stringify(this.tasks));
  }

  createActiveTaskCounter() {
    const counter = document.getElementById('todo-counter-content');
    let amount = this.activeTasks.length;

    switch (amount) {
      case 0:
        counter.innerHTML = 'All tasks completed!';
        break;

      case 1:
        counter.innerHTML = `${amount} task left`;
        break;

      default:
        counter.innerHTML = `${amount} tasks left`;
    }
  }

}

const toDoContainer = document.getElementById('todo-items');
const toDoList = new ToDoList(toDoContainer);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIlRhc2siLCJjb25zdHJ1Y3RvciIsImNvbnRlbnQiLCJpc0NvbXBsZXRlZCIsIlRvRG9MaXN0IiwidGFza3NDb250YWluZXIiLCJ0YXNrcyIsIkpTT04iLCJwYXJzZSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJfYWN0aXZlVGFza3MiLCJfY29tcGxldGVkVGFza3MiLCJiaW5kQWRkVGFza0J1dHRvbiIsImNyZWF0ZVRhc2tzRmlsdGVycyIsImNyZWF0ZVRhc2tzTGlzdCIsImFjdGl2ZVRhc2tzIiwiZmlsdGVyIiwidGFzayIsImNvbXBsZXRlZFRhc2tzIiwiYnV0dG9uIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImlucHV0IiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJrZXkiLCJzYXZlVGFzayIsInZhbHVlIiwidW5zaGlmdCIsImFkZFRvTG9jYWxTdG9yYWdlIiwiYWxlcnQiLCJ0YXNrc0FycmF5IiwiY3JlYXRlQWN0aXZlVGFza0NvdW50ZXIiLCJpbm5lckhUTUwiLCJmb3JFYWNoIiwidGFza0luZGV4IiwidGFza0l0ZW0iLCJjcmVhdGVFbGVtZW50IiwidGFza0NvbnRlbnQiLCJ0YXNrQWN0aW9ucyIsImRvbmVCdXR0b24iLCJkb25lVGFza0NsYXNzIiwicmVtb3ZlQnV0dG9uIiwiY2xhc3NMaXN0IiwiYWRkIiwic2V0QXR0cmlidXRlIiwiY3VycmVudFRhcmdldCIsInBhcmVudE5vZGUiLCJyZW1vdmVDaGlsZCIsInNwbGljZSIsImFwcGVuZCIsInNob3dBbGwiLCJzaG93QWN0aXZlIiwic2hvd0NvbXBsZXRlZCIsImNsZWFyQ29tcGxldGVkIiwicHJldmVudERlZmF1bHQiLCJsZW5ndGgiLCJjb21wbGV0ZWRUYXNrIiwiZmluZEluZGV4Iiwic2V0SXRlbSIsInN0cmluZ2lmeSIsImNvdW50ZXIiLCJhbW91bnQiLCJ0b0RvQ29udGFpbmVyIiwidG9Eb0xpc3QiXSwibWFwcGluZ3MiOiJBQUFBLE1BQUFBLElBQUEsQ0FBQTtBQUNBQyxFQUFBQSxXQUFBLENBQUFDLE9BQUEsRUFBQTtBQUNBLFNBQUFBLE9BQUEsR0FBQUEsT0FBQTtBQUNBLFNBQUFDLFdBQUEsR0FBQSxLQUFBO0FBQ0E7O0FBSkE7O0FBT0EsTUFBQUMsUUFBQSxDQUFBO0FBQ0FILEVBQUFBLFdBQUEsQ0FBQUksY0FBQSxFQUFBO0FBQ0EsU0FBQUEsY0FBQSxHQUFBQSxjQUFBO0FBQ0EsU0FBQUMsS0FBQSxHQUFBQyxJQUFBLENBQUFDLEtBQUEsQ0FBQUMsWUFBQSxDQUFBQyxPQUFBLENBQUEsT0FBQSxDQUFBLEtBQUEsRUFBQTtBQUNBLFNBQUFDLFlBQUEsR0FBQSxFQUFBO0FBQ0EsU0FBQUMsZUFBQSxHQUFBLEVBQUE7QUFFQSxTQUFBQyxpQkFBQTtBQUNBLFNBQUFDLGtCQUFBO0FBQ0EsU0FBQUMsZUFBQSxDQUFBLEtBQUFULEtBQUE7QUFDQTs7QUFFQSxNQUFBVSxXQUFBLEdBQUE7QUFDQSxTQUFBTCxZQUFBLEdBQUEsS0FBQUwsS0FBQSxDQUFBVyxNQUFBLENBQUFDLElBQUEsSUFBQUEsSUFBQSxDQUFBZixXQUFBLEtBQUEsS0FBQSxDQUFBO0FBQ0EsV0FBQSxLQUFBUSxZQUFBO0FBQ0E7O0FBRUEsTUFBQVEsY0FBQSxHQUFBO0FBQ0EsU0FBQVAsZUFBQSxHQUFBLEtBQUFOLEtBQUEsQ0FBQVcsTUFBQSxDQUFBQyxJQUFBLElBQUFBLElBQUEsQ0FBQWYsV0FBQSxLQUFBLElBQUEsQ0FBQTtBQUNBLFdBQUEsS0FBQVMsZUFBQTtBQUNBOztBQUVBQyxFQUFBQSxpQkFBQSxHQUFBO0FBQ0EsVUFBQU8sTUFBQSxHQUFBQyxRQUFBLENBQUFDLGNBQUEsQ0FBQSxpQkFBQSxDQUFBO0FBQ0EsVUFBQUMsS0FBQSxHQUFBRixRQUFBLENBQUFDLGNBQUEsQ0FBQSxZQUFBLENBQUE7QUFFQUMsSUFBQUEsS0FBQSxDQUFBQyxnQkFBQSxDQUFBLE9BQUEsRUFBQUMsQ0FBQSxJQUFBO0FBQ0EsVUFBQUEsQ0FBQSxDQUFBQyxHQUFBLEtBQUEsT0FBQSxFQUFBO0FBQ0EsYUFBQUMsUUFBQSxDQUFBSixLQUFBLENBQUFLLEtBQUE7QUFDQUwsUUFBQUEsS0FBQSxDQUFBSyxLQUFBLEdBQUEsRUFBQTtBQUNBO0FBQ0EsS0FMQTtBQU9BUixJQUFBQSxNQUFBLENBQUFJLGdCQUFBLENBQUEsT0FBQSxFQUFBLE1BQUE7QUFDQSxXQUFBRyxRQUFBLENBQUFKLEtBQUEsQ0FBQUssS0FBQTtBQUNBTCxNQUFBQSxLQUFBLENBQUFLLEtBQUEsR0FBQSxFQUFBO0FBQ0EsS0FIQTtBQUlBOztBQUVBRCxFQUFBQSxRQUFBLENBQUF6QixPQUFBLEVBQUE7QUFDQSxRQUFBQSxPQUFBLEtBQUEsRUFBQSxFQUFBO0FBQ0EsWUFBQWdCLElBQUEsR0FBQSxJQUFBbEIsSUFBQSxDQUFBRSxPQUFBLENBQUE7QUFDQSxXQUFBSSxLQUFBLENBQUF1QixPQUFBLENBQUFYLElBQUE7QUFDQSxXQUFBWSxpQkFBQTtBQUNBLFdBQUFmLGVBQUEsQ0FBQSxLQUFBVCxLQUFBO0FBRUE7QUFDQTs7QUFFQXlCLElBQUFBLEtBQUEsQ0FBQSxpQkFBQSxDQUFBO0FBQ0E7O0FBRUFoQixFQUFBQSxlQUFBLENBQUFpQixVQUFBLEVBQUE7QUFDQSxTQUFBQyx1QkFBQTtBQUNBLFNBQUE1QixjQUFBLENBQUE2QixTQUFBLEdBQUEsRUFBQTtBQUVBRixJQUFBQSxVQUFBLENBQUFHLE9BQUEsQ0FBQSxDQUFBakIsSUFBQSxFQUFBa0IsU0FBQSxLQUFBO0FBQ0EsWUFBQUMsUUFBQSxHQUFBaEIsUUFBQSxDQUFBaUIsYUFBQSxDQUFBLElBQUEsQ0FBQTtBQUNBLFlBQUFDLFdBQUEsR0FBQWxCLFFBQUEsQ0FBQWlCLGFBQUEsQ0FBQSxNQUFBLENBQUE7QUFDQSxZQUFBRSxXQUFBLEdBQUFuQixRQUFBLENBQUFpQixhQUFBLENBQUEsS0FBQSxDQUFBO0FBRUEsWUFBQUcsVUFBQSxHQUFBcEIsUUFBQSxDQUFBaUIsYUFBQSxDQUFBLFFBQUEsQ0FBQTtBQUNBLFlBQUFJLGFBQUEsR0FBQSxxQkFBQTtBQUNBLFlBQUFDLFlBQUEsR0FBQXRCLFFBQUEsQ0FBQWlCLGFBQUEsQ0FBQSxRQUFBLENBQUE7QUFFQUQsTUFBQUEsUUFBQSxDQUFBTyxTQUFBLENBQUFDLEdBQUEsQ0FBQSxXQUFBO0FBQ0FOLE1BQUFBLFdBQUEsQ0FBQUssU0FBQSxDQUFBQyxHQUFBLENBQUEsbUJBQUE7QUFDQUwsTUFBQUEsV0FBQSxDQUFBSSxTQUFBLENBQUFDLEdBQUEsQ0FBQSxtQkFBQTtBQUVBTixNQUFBQSxXQUFBLENBQUFMLFNBQUEsR0FBQWhCLElBQUEsQ0FBQWhCLE9BQUE7QUFFQXVDLE1BQUFBLFVBQUEsQ0FBQUssWUFBQSxDQUFBLE9BQUEsRUFBQSxtQ0FBQTtBQUNBTCxNQUFBQSxVQUFBLENBQUFQLFNBQUEsR0FBQSxNQUFBO0FBRUFPLE1BQUFBLFVBQUEsQ0FBQWpCLGdCQUFBLENBQUEsT0FBQSxFQUFBQyxDQUFBLElBQUE7QUFDQUEsUUFBQUEsQ0FBQSxDQUFBc0IsYUFBQSxDQUFBQyxVQUFBLENBQUFBLFVBQUEsQ0FBQUosU0FBQSxDQUFBQyxHQUFBLENBQUFILGFBQUE7QUFDQUYsUUFBQUEsV0FBQSxDQUFBUyxXQUFBLENBQUFSLFVBQUE7QUFDQXZCLFFBQUFBLElBQUEsQ0FBQWYsV0FBQSxHQUFBLElBQUE7QUFDQSxhQUFBMkIsaUJBQUE7QUFDQSxhQUFBZixlQUFBLENBQUEsS0FBQVQsS0FBQTtBQUNBLE9BTkE7QUFRQXFDLE1BQUFBLFlBQUEsQ0FBQUcsWUFBQSxDQUFBLE9BQUEsRUFBQSxxQ0FBQTtBQUNBSCxNQUFBQSxZQUFBLENBQUFULFNBQUEsR0FBQSxRQUFBO0FBRUFTLE1BQUFBLFlBQUEsQ0FBQW5CLGdCQUFBLENBQUEsT0FBQSxFQUFBLE1BQUE7QUFDQSxhQUFBbkIsY0FBQSxDQUFBNEMsV0FBQSxDQUFBWixRQUFBO0FBQ0EsYUFBQS9CLEtBQUEsQ0FBQTRDLE1BQUEsQ0FBQWQsU0FBQSxFQUFBLENBQUE7QUFDQSxhQUFBTixpQkFBQTtBQUNBLGFBQUFmLGVBQUEsQ0FBQSxLQUFBVCxLQUFBO0FBQ0EsT0FMQTs7QUFPQSxVQUFBWSxJQUFBLENBQUFmLFdBQUEsRUFBQTtBQUNBa0MsUUFBQUEsUUFBQSxDQUFBTyxTQUFBLENBQUFDLEdBQUEsQ0FBQUgsYUFBQTtBQUNBRixRQUFBQSxXQUFBLENBQUFXLE1BQUEsQ0FBQVIsWUFBQTtBQUNBOztBQUVBLFVBQUEsQ0FBQXpCLElBQUEsQ0FBQWYsV0FBQSxFQUFBO0FBQ0FxQyxRQUFBQSxXQUFBLENBQUFXLE1BQUEsQ0FBQVYsVUFBQSxFQUFBRSxZQUFBO0FBQ0E7O0FBRUFOLE1BQUFBLFFBQUEsQ0FBQWMsTUFBQSxDQUFBWixXQUFBLEVBQUFDLFdBQUE7QUFDQSxXQUFBbkMsY0FBQSxDQUFBOEMsTUFBQSxDQUFBZCxRQUFBO0FBQ0EsS0EvQ0E7QUFnREE7O0FBRUF2QixFQUFBQSxrQkFBQSxHQUFBO0FBQ0EsVUFBQXNDLE9BQUEsR0FBQS9CLFFBQUEsQ0FBQUMsY0FBQSxDQUFBLGVBQUEsQ0FBQTtBQUNBLFVBQUErQixVQUFBLEdBQUFoQyxRQUFBLENBQUFDLGNBQUEsQ0FBQSxrQkFBQSxDQUFBO0FBQ0EsVUFBQWdDLGFBQUEsR0FBQWpDLFFBQUEsQ0FBQUMsY0FBQSxDQUFBLHFCQUFBLENBQUE7QUFDQSxVQUFBaUMsY0FBQSxHQUFBbEMsUUFBQSxDQUFBQyxjQUFBLENBQUEsc0JBQUEsQ0FBQTtBQUVBOEIsSUFBQUEsT0FBQSxDQUFBNUIsZ0JBQUEsQ0FBQSxPQUFBLEVBQUFDLENBQUEsSUFBQTtBQUNBQSxNQUFBQSxDQUFBLENBQUErQixjQUFBO0FBQ0EsV0FBQXpDLGVBQUEsQ0FBQSxLQUFBVCxLQUFBO0FBQ0EsS0FIQTtBQUtBK0MsSUFBQUEsVUFBQSxDQUFBN0IsZ0JBQUEsQ0FBQSxPQUFBLEVBQUFDLENBQUEsSUFBQTtBQUNBQSxNQUFBQSxDQUFBLENBQUErQixjQUFBO0FBQ0EsV0FBQXpDLGVBQUEsQ0FBQSxLQUFBQyxXQUFBO0FBQ0EsS0FIQTtBQUtBc0MsSUFBQUEsYUFBQSxDQUFBOUIsZ0JBQUEsQ0FBQSxPQUFBLEVBQUFDLENBQUEsSUFBQTtBQUNBQSxNQUFBQSxDQUFBLENBQUErQixjQUFBO0FBQ0EsV0FBQXpDLGVBQUEsQ0FBQSxLQUFBSSxjQUFBO0FBQ0EsS0FIQTtBQUtBb0MsSUFBQUEsY0FBQSxDQUFBL0IsZ0JBQUEsQ0FBQSxPQUFBLEVBQUFDLENBQUEsSUFBQTtBQUNBQSxNQUFBQSxDQUFBLENBQUErQixjQUFBOztBQUVBLFVBQUEsS0FBQXJDLGNBQUEsQ0FBQXNDLE1BQUEsRUFBQTtBQUNBLGFBQUF0QyxjQUFBLENBQUFnQixPQUFBLENBQUF1QixhQUFBLElBQUE7QUFDQSxlQUFBcEQsS0FBQSxDQUFBNEMsTUFBQSxDQUFBLEtBQUE1QyxLQUFBLENBQUFxRCxTQUFBLENBQUF6QyxJQUFBLElBQUFBLElBQUEsQ0FBQWhCLE9BQUEsS0FBQXdELGFBQUEsQ0FBQXhELE9BQUEsQ0FBQSxFQUFBLENBQUE7QUFDQSxTQUZBO0FBSUEsYUFBQTRCLGlCQUFBO0FBQ0EsYUFBQWYsZUFBQSxDQUFBLEtBQUFULEtBQUE7QUFFQTtBQUNBOztBQUVBeUIsTUFBQUEsS0FBQSxDQUFBLCtCQUFBLENBQUE7QUFDQSxLQWZBO0FBZ0JBOztBQUVBRCxFQUFBQSxpQkFBQSxHQUFBO0FBQ0FyQixJQUFBQSxZQUFBLENBQUFtRCxPQUFBLENBQUEsT0FBQSxFQUFBckQsSUFBQSxDQUFBc0QsU0FBQSxDQUFBLEtBQUF2RCxLQUFBLENBQUE7QUFDQTs7QUFFQTJCLEVBQUFBLHVCQUFBLEdBQUE7QUFDQSxVQUFBNkIsT0FBQSxHQUFBekMsUUFBQSxDQUFBQyxjQUFBLENBQUEsc0JBQUEsQ0FBQTtBQUNBLFFBQUF5QyxNQUFBLEdBQUEsS0FBQS9DLFdBQUEsQ0FBQXlDLE1BQUE7O0FBRUEsWUFBQU0sTUFBQTtBQUNBLFdBQUEsQ0FBQTtBQUNBRCxRQUFBQSxPQUFBLENBQUE1QixTQUFBLEdBQUEsc0JBQUE7QUFDQTs7QUFDQSxXQUFBLENBQUE7QUFDQTRCLFFBQUFBLE9BQUEsQ0FBQTVCLFNBQUEsR0FBQSxHQUFBNkIsTUFBQSxZQUFBO0FBQ0E7O0FBQ0E7QUFDQUQsUUFBQUEsT0FBQSxDQUFBNUIsU0FBQSxHQUFBLEdBQUE2QixNQUFBLGFBQUE7QUFSQTtBQVVBOztBQW5LQTs7QUFzS0EsTUFBQUMsYUFBQSxHQUFBM0MsUUFBQSxDQUFBQyxjQUFBLENBQUEsWUFBQSxDQUFBO0FBQ0EsTUFBQTJDLFFBQUEsR0FBQSxJQUFBN0QsUUFBQSxDQUFBNEQsYUFBQSxDQUFBIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgVGFzayB7XHJcbiAgICBjb25zdHJ1Y3RvciAoY29udGVudCkge1xyXG4gICAgICAgIHRoaXMuY29udGVudCA9IGNvbnRlbnQ7XHJcbiAgICAgICAgdGhpcy5pc0NvbXBsZXRlZCA9IGZhbHNlO1xyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBUb0RvTGlzdCB7XHJcbiAgICBjb25zdHJ1Y3RvciAodGFza3NDb250YWluZXIpIHtcclxuICAgICAgICB0aGlzLnRhc2tzQ29udGFpbmVyID0gdGFza3NDb250YWluZXI7XHJcbiAgICAgICAgdGhpcy50YXNrcyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3Rhc2tzJykpIHx8IFtdO1xyXG4gICAgICAgIHRoaXMuX2FjdGl2ZVRhc2tzID0gW107XHJcbiAgICAgICAgdGhpcy5fY29tcGxldGVkVGFza3MgPSBbXTtcclxuXHJcbiAgICAgICAgdGhpcy5iaW5kQWRkVGFza0J1dHRvbigpO1xyXG4gICAgICAgIHRoaXMuY3JlYXRlVGFza3NGaWx0ZXJzKCk7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVUYXNrc0xpc3QodGhpcy50YXNrcyk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGFjdGl2ZVRhc2tzICgpIHtcclxuICAgICAgICB0aGlzLl9hY3RpdmVUYXNrcyA9IHRoaXMudGFza3MuZmlsdGVyKCh0YXNrKSA9PiB0YXNrLmlzQ29tcGxldGVkID09PSBmYWxzZSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGl2ZVRhc2tzO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjb21wbGV0ZWRUYXNrcyAoKSB7XHJcbiAgICAgICAgdGhpcy5fY29tcGxldGVkVGFza3MgPSB0aGlzLnRhc2tzLmZpbHRlcigodGFzaykgPT4gdGFzay5pc0NvbXBsZXRlZCA9PT0gdHJ1ZSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbXBsZXRlZFRhc2tzO1xyXG4gICAgfVxyXG5cclxuICAgIGJpbmRBZGRUYXNrQnV0dG9uICgpIHtcclxuICAgICAgICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9kby1idXR0b24tYWRkJyk7XHJcbiAgICAgICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9kby1pbnB1dCcpO1xyXG5cclxuICAgICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIChlKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChlLmtleSA9PT0gJ0VudGVyJykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zYXZlVGFzayhpbnB1dC52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZSA9ICcnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNhdmVUYXNrKGlucHV0LnZhbHVlKTtcclxuICAgICAgICAgICAgaW5wdXQudmFsdWUgPSAnJztcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIHNhdmVUYXNrIChjb250ZW50KSB7XHJcbiAgICAgICAgaWYgKGNvbnRlbnQgIT09ICcnKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRhc2sgPSBuZXcgVGFzayhjb250ZW50KTtcclxuICAgICAgICAgICAgdGhpcy50YXNrcy51bnNoaWZ0KHRhc2spO1xyXG4gICAgICAgICAgICB0aGlzLmFkZFRvTG9jYWxTdG9yYWdlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlVGFza3NMaXN0KHRoaXMudGFza3MpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYWxlcnQoJ1R5cGUgc29tZXRoaW5nIScpO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZVRhc2tzTGlzdCAodGFza3NBcnJheSkge1xyXG4gICAgICAgIHRoaXMuY3JlYXRlQWN0aXZlVGFza0NvdW50ZXIoKTtcclxuICAgICAgICB0aGlzLnRhc2tzQ29udGFpbmVyLmlubmVySFRNTCA9ICcnO1xyXG5cclxuICAgICAgICB0YXNrc0FycmF5LmZvckVhY2goKHRhc2ssIHRhc2tJbmRleCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB0YXNrSXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHRhc2tDb250ZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xyXG4gICAgICAgICAgICBjb25zdCB0YXNrQWN0aW9ucyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgZG9uZUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xyXG4gICAgICAgICAgICBjb25zdCBkb25lVGFza0NsYXNzID0gJ3RvZG8taXRlbS1jb21wbGV0ZWQnO1xyXG4gICAgICAgICAgICBjb25zdCByZW1vdmVCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcclxuXHJcbiAgICAgICAgICAgIHRhc2tJdGVtLmNsYXNzTGlzdC5hZGQoJ3RvZG8taXRlbScpO1xyXG4gICAgICAgICAgICB0YXNrQ29udGVudC5jbGFzc0xpc3QuYWRkKCd0b2RvLWl0ZW0tY29udGVudCcpO1xyXG4gICAgICAgICAgICB0YXNrQWN0aW9ucy5jbGFzc0xpc3QuYWRkKCd0b2RvLWl0ZW0tYWN0aW9ucycpO1xyXG5cclxuICAgICAgICAgICAgdGFza0NvbnRlbnQuaW5uZXJIVE1MID0gdGFzay5jb250ZW50O1xyXG5cclxuICAgICAgICAgICAgZG9uZUJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3RvZG8tdGFzay1idXR0b24gdG9kby1kb25lLWJ1dHRvbicpXHJcbiAgICAgICAgICAgIGRvbmVCdXR0b24uaW5uZXJIVE1MID0gJ0RvbmUnO1xyXG5cclxuICAgICAgICAgICAgZG9uZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBlLmN1cnJlbnRUYXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoZG9uZVRhc2tDbGFzcyk7XHJcbiAgICAgICAgICAgICAgICB0YXNrQWN0aW9ucy5yZW1vdmVDaGlsZChkb25lQnV0dG9uKTtcclxuICAgICAgICAgICAgICAgIHRhc2suaXNDb21wbGV0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZGRUb0xvY2FsU3RvcmFnZSgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVUYXNrc0xpc3QodGhpcy50YXNrcyk7XHJcbiAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICByZW1vdmVCdXR0b24uc2V0QXR0cmlidXRlKCdjbGFzcycsICd0b2RvLXRhc2stYnV0dG9uIHRvZG8tcmVtb3ZlLWJ1dHRvbicpXHJcbiAgICAgICAgICAgIHJlbW92ZUJ1dHRvbi5pbm5lckhUTUwgPSAnRGVsZXRlJztcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHJlbW92ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGFza3NDb250YWluZXIucmVtb3ZlQ2hpbGQodGFza0l0ZW0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50YXNrcy5zcGxpY2UodGFza0luZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWRkVG9Mb2NhbFN0b3JhZ2UoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlVGFza3NMaXN0KHRoaXMudGFza3MpO1xyXG4gICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgaWYgKHRhc2suaXNDb21wbGV0ZWQpIHtcclxuICAgICAgICAgICAgICAgIHRhc2tJdGVtLmNsYXNzTGlzdC5hZGQoZG9uZVRhc2tDbGFzcyk7XHJcbiAgICAgICAgICAgICAgICB0YXNrQWN0aW9ucy5hcHBlbmQocmVtb3ZlQnV0dG9uKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCF0YXNrLmlzQ29tcGxldGVkKSB7XHJcbiAgICAgICAgICAgICAgICB0YXNrQWN0aW9ucy5hcHBlbmQoZG9uZUJ1dHRvbiwgcmVtb3ZlQnV0dG9uKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGFza0l0ZW0uYXBwZW5kKHRhc2tDb250ZW50LCB0YXNrQWN0aW9ucyk7XHJcbiAgICAgICAgICAgIHRoaXMudGFza3NDb250YWluZXIuYXBwZW5kKHRhc2tJdGVtKTtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZVRhc2tzRmlsdGVycyAoKSB7XHJcbiAgICAgICAgY29uc3Qgc2hvd0FsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2RvLXNob3ctYWxsJyk7XHJcbiAgICAgICAgY29uc3Qgc2hvd0FjdGl2ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2RvLXNob3ctYWN0aXZlJyk7XHJcbiAgICAgICAgY29uc3Qgc2hvd0NvbXBsZXRlZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2RvLXNob3ctY29tcGxldGVkJyk7XHJcbiAgICAgICAgY29uc3QgY2xlYXJDb21wbGV0ZWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9kby1jbGVhci1jb21wbGV0ZWQnKTtcclxuXHJcbiAgICAgICAgc2hvd0FsbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgdGhpcy5jcmVhdGVUYXNrc0xpc3QodGhpcy50YXNrcyk7XHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgc2hvd0FjdGl2ZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgdGhpcy5jcmVhdGVUYXNrc0xpc3QodGhpcy5hY3RpdmVUYXNrcyk7XHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgc2hvd0NvbXBsZXRlZC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgdGhpcy5jcmVhdGVUYXNrc0xpc3QodGhpcy5jb21wbGV0ZWRUYXNrcyk7XHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgY2xlYXJDb21wbGV0ZWQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5jb21wbGV0ZWRUYXNrcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29tcGxldGVkVGFza3MuZm9yRWFjaChjb21wbGV0ZWRUYXNrID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRhc2tzLnNwbGljZSh0aGlzLnRhc2tzLmZpbmRJbmRleCh0YXNrID0+IHRhc2suY29udGVudCA9PT0gY29tcGxldGVkVGFzay5jb250ZW50KSwgMSk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuYWRkVG9Mb2NhbFN0b3JhZ2UoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlVGFza3NMaXN0KHRoaXMudGFza3MpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgYWxlcnQoJ0FsbCB0YXNrcyBoYXZlIGFjdGl2ZSBzdGF0dXMhJyk7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICBhZGRUb0xvY2FsU3RvcmFnZSAoKSB7XHJcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3Rhc2tzJywgSlNPTi5zdHJpbmdpZnkodGhpcy50YXNrcykpO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUFjdGl2ZVRhc2tDb3VudGVyICgpIHtcclxuICAgICAgICBjb25zdCBjb3VudGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvZG8tY291bnRlci1jb250ZW50Jyk7XHJcbiAgICAgICAgbGV0IGFtb3VudCA9IHRoaXMuYWN0aXZlVGFza3MubGVuZ3RoO1xyXG5cclxuICAgICAgICBzd2l0Y2ggKGFtb3VudCkge1xyXG4gICAgICAgICAgICBjYXNlIDA6XHJcbiAgICAgICAgICAgICAgICBjb3VudGVyLmlubmVySFRNTCA9ICdBbGwgdGFza3MgY29tcGxldGVkISc7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgY291bnRlci5pbm5lckhUTUwgPSBgJHthbW91bnR9IHRhc2sgbGVmdGA7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIGNvdW50ZXIuaW5uZXJIVE1MID0gYCR7YW1vdW50fSB0YXNrcyBsZWZ0YDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmNvbnN0IHRvRG9Db250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9kby1pdGVtcycpO1xyXG5jb25zdCB0b0RvTGlzdCA9IG5ldyBUb0RvTGlzdCh0b0RvQ29udGFpbmVyKTtcclxuIl19
