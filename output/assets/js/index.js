class Task {
  constructor(content) {
    this.content = content;
    this.isCompleted = false;
  }

}

class ToDoList {
  constructor(tasksContainer) {
    this.tasksContainer = tasksContainer;
    this.tasks = JSON.parse(localStorage.getItem('tasks')) || [];
    this._activeTasks = [];
    this._completedTasks = [];
    this.bindAddTaskButton();
    this.createTasksFilters();
    this.createTasksList(this.tasks);
  }

  get activeTasks() {
    this._activeTasks = this.tasks.filter(task => task.isCompleted === false);
    return this._activeTasks;
  }

  get completedTasks() {
    this._completedTasks = this.tasks.filter(task => task.isCompleted === true);
    return this._completedTasks;
  }

  bindAddTaskButton() {
    const button = document.getElementById('todo-button-add');
    const input = document.getElementById('todo-input');
    input.addEventListener('keyup', e => {
      if (e.key === 'Enter') {
        this.saveTask(input.value);
        input.value = '';
      }
    });
    button.addEventListener('click', () => {
      this.saveTask(input.value);
      input.value = '';
    });
  }

  saveTask(content) {
    if (content !== '') {
      const task = new Task(content);
      this.tasks.unshift(task);
      this.addToLocalStorage();
      this.createTasksList(this.tasks);
      return;
    }

    alert('Type something!');
  }

  createTasksList(tasksArray) {
    this.createActiveTasksCounter();
    this.tasksContainer.innerHTML = '';
    tasksArray.forEach((task, taskIndex) => {
      const taskItem = document.createElement('li');
      const taskContent = document.createElement('span');
      const taskActions = document.createElement('div');
      const doneButton = document.createElement('button');
      const doneTaskClass = 'todo-item-completed';
      const removeButton = document.createElement('button');
      taskItem.classList.add('todo-item');
      taskContent.classList.add('todo-item-content');
      taskActions.classList.add('todo-item-actions');
      taskContent.innerHTML = task.content;
      doneButton.setAttribute('class', 'todo-task-button todo-done-button');
      doneButton.innerHTML = 'Done';
      doneButton.addEventListener('click', e => {
        e.currentTarget.parentNode.parentNode.classList.add(doneTaskClass);
        taskActions.removeChild(doneButton);
        task.isCompleted = true;
        this.addToLocalStorage();
        this.createTasksList(this.tasks);
      });
      removeButton.setAttribute('class', 'todo-task-button todo-remove-button');
      removeButton.innerHTML = 'Delete';
      removeButton.addEventListener('click', () => {
        this.tasksContainer.removeChild(taskItem);
        this.tasks.splice(taskIndex, 1);
        this.addToLocalStorage();
        this.createTasksList(this.tasks);
      });

      if (task.isCompleted) {
        taskItem.classList.add(doneTaskClass);
        taskActions.append(removeButton);
      }

      if (!task.isCompleted) {
        taskActions.append(doneButton, removeButton);
      }

      taskItem.append(taskContent, taskActions);
      this.tasksContainer.append(taskItem);
    });
  }

  createTasksFilters() {
    const showAll = document.getElementById('todo-show-all');
    const showActive = document.getElementById('todo-show-active');
    const showCompleted = document.getElementById('todo-show-completed');
    const clearCompleted = document.getElementById('todo-clear-completed');
    showAll.addEventListener('click', e => {
      e.preventDefault();
      this.createTasksList(this.tasks);
    });
    showActive.addEventListener('click', e => {
      e.preventDefault();
      this.createTasksList(this.activeTasks);
    });
    showCompleted.addEventListener('click', e => {
      e.preventDefault();
      this.createTasksList(this.completedTasks);
    });
    clearCompleted.addEventListener('click', e => {
      e.preventDefault();

      if (this.completedTasks.length) {
        this.completedTasks.forEach(completedTask => {
          this.tasks.splice(this.tasks.findIndex(task => task.content === completedTask.content), 1);
        });
        this.addToLocalStorage();
        this.createTasksList(this.tasks);
        return;
      }

      alert('All tasks have active status!');
    });
  }

  addToLocalStorage() {
    localStorage.setItem('tasks', JSON.stringify(this.tasks));
  }

  createActiveTasksCounter() {
    const counter = document.getElementById('todo-counter-content');
    let amount = this.activeTasks.length;

    switch (amount) {
      case 0:
        counter.innerHTML = 'All tasks completed!';
        break;

      case 1:
        counter.innerHTML = `${amount} task left`;
        break;

      default:
        counter.innerHTML = `${amount} tasks left`;
    }
  }

}

const toDoContainer = document.getElementById('todo-items');
const toDoList = new ToDoList(toDoContainer);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIlRhc2siLCJjb25zdHJ1Y3RvciIsImNvbnRlbnQiLCJpc0NvbXBsZXRlZCIsIlRvRG9MaXN0IiwidGFza3NDb250YWluZXIiLCJ0YXNrcyIsIkpTT04iLCJwYXJzZSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJfYWN0aXZlVGFza3MiLCJfY29tcGxldGVkVGFza3MiLCJiaW5kQWRkVGFza0J1dHRvbiIsImNyZWF0ZVRhc2tzRmlsdGVycyIsImNyZWF0ZVRhc2tzTGlzdCIsImFjdGl2ZVRhc2tzIiwiZmlsdGVyIiwidGFzayIsImNvbXBsZXRlZFRhc2tzIiwiYnV0dG9uIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImlucHV0IiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJrZXkiLCJzYXZlVGFzayIsInZhbHVlIiwidW5zaGlmdCIsImFkZFRvTG9jYWxTdG9yYWdlIiwiYWxlcnQiLCJ0YXNrc0FycmF5IiwiY3JlYXRlQWN0aXZlVGFza3NDb3VudGVyIiwiaW5uZXJIVE1MIiwiZm9yRWFjaCIsInRhc2tJbmRleCIsInRhc2tJdGVtIiwiY3JlYXRlRWxlbWVudCIsInRhc2tDb250ZW50IiwidGFza0FjdGlvbnMiLCJkb25lQnV0dG9uIiwiZG9uZVRhc2tDbGFzcyIsInJlbW92ZUJ1dHRvbiIsImNsYXNzTGlzdCIsImFkZCIsInNldEF0dHJpYnV0ZSIsImN1cnJlbnRUYXJnZXQiLCJwYXJlbnROb2RlIiwicmVtb3ZlQ2hpbGQiLCJzcGxpY2UiLCJhcHBlbmQiLCJzaG93QWxsIiwic2hvd0FjdGl2ZSIsInNob3dDb21wbGV0ZWQiLCJjbGVhckNvbXBsZXRlZCIsInByZXZlbnREZWZhdWx0IiwibGVuZ3RoIiwiY29tcGxldGVkVGFzayIsImZpbmRJbmRleCIsInNldEl0ZW0iLCJzdHJpbmdpZnkiLCJjb3VudGVyIiwiYW1vdW50IiwidG9Eb0NvbnRhaW5lciIsInRvRG9MaXN0Il0sIm1hcHBpbmdzIjoiQUFBQSxN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QUFBLE9BQUEsQ0FBQTVCLFNBQUEsR0FBQSxHQUFBNkIsTUFBQSxhQUFBO0FBUkE7QUFVQTs7QUFuS0E7O0FBc0tBLE1BQUFDLGFBQUEsR0FBQTNDLFFBQUEsQ0FBQUMsY0FBQSxDQUFBLFlBQUEsQ0FBQTtBQUNBLE1BQUEyQyxRQUFBLEdBQUEsSUFBQTdELFFBQUEsQ0FBQTRELGFBQUEsQ0FBQSIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImNsYXNzIFRhc2sge1xyXG4gICAgY29uc3RydWN0b3IgKGNvbnRlbnQpIHtcclxuICAgICAgICB0aGlzLmNvbnRlbnQgPSBjb250ZW50O1xyXG4gICAgICAgIHRoaXMuaXNDb21wbGV0ZWQgPSBmYWxzZTtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgVG9Eb0xpc3Qge1xyXG4gICAgY29uc3RydWN0b3IgKHRhc2tzQ29udGFpbmVyKSB7XHJcbiAgICAgICAgdGhpcy50YXNrc0NvbnRhaW5lciA9IHRhc2tzQ29udGFpbmVyO1xyXG4gICAgICAgIHRoaXMudGFza3MgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd0YXNrcycpKSB8fCBbXTtcclxuICAgICAgICB0aGlzLl9hY3RpdmVUYXNrcyA9IFtdO1xyXG4gICAgICAgIHRoaXMuX2NvbXBsZXRlZFRhc2tzID0gW107XHJcblxyXG4gICAgICAgIHRoaXMuYmluZEFkZFRhc2tCdXR0b24oKTtcclxuICAgICAgICB0aGlzLmNyZWF0ZVRhc2tzRmlsdGVycygpO1xyXG4gICAgICAgIHRoaXMuY3JlYXRlVGFza3NMaXN0KHRoaXMudGFza3MpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBhY3RpdmVUYXNrcyAoKSB7XHJcbiAgICAgICAgdGhpcy5fYWN0aXZlVGFza3MgPSB0aGlzLnRhc2tzLmZpbHRlcigodGFzaykgPT4gdGFzay5pc0NvbXBsZXRlZCA9PT0gZmFsc2UpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9hY3RpdmVUYXNrcztcclxuICAgIH1cclxuXHJcbiAgICBnZXQgY29tcGxldGVkVGFza3MgKCkge1xyXG4gICAgICAgIHRoaXMuX2NvbXBsZXRlZFRhc2tzID0gdGhpcy50YXNrcy5maWx0ZXIoKHRhc2spID0+IHRhc2suaXNDb21wbGV0ZWQgPT09IHRydWUpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9jb21wbGV0ZWRUYXNrcztcclxuICAgIH1cclxuXHJcbiAgICBiaW5kQWRkVGFza0J1dHRvbiAoKSB7XHJcbiAgICAgICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvZG8tYnV0dG9uLWFkZCcpO1xyXG4gICAgICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvZG8taW5wdXQnKTtcclxuXHJcbiAgICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZS5rZXkgPT09ICdFbnRlcicpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2F2ZVRhc2soaW5wdXQudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgaW5wdXQudmFsdWUgPSAnJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zYXZlVGFzayhpbnB1dC52YWx1ZSk7XHJcbiAgICAgICAgICAgIGlucHV0LnZhbHVlID0gJyc7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICBzYXZlVGFzayAoY29udGVudCkge1xyXG4gICAgICAgIGlmIChjb250ZW50ICE9PSAnJykge1xyXG4gICAgICAgICAgICBjb25zdCB0YXNrID0gbmV3IFRhc2soY29udGVudCk7XHJcbiAgICAgICAgICAgIHRoaXMudGFza3MudW5zaGlmdCh0YXNrKTtcclxuICAgICAgICAgICAgdGhpcy5hZGRUb0xvY2FsU3RvcmFnZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZVRhc2tzTGlzdCh0aGlzLnRhc2tzKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGFsZXJ0KCdUeXBlIHNvbWV0aGluZyEnKTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVUYXNrc0xpc3QgKHRhc2tzQXJyYXkpIHtcclxuICAgICAgICB0aGlzLmNyZWF0ZUFjdGl2ZVRhc2tzQ291bnRlcigpO1xyXG4gICAgICAgIHRoaXMudGFza3NDb250YWluZXIuaW5uZXJIVE1MID0gJyc7XHJcblxyXG4gICAgICAgIHRhc2tzQXJyYXkuZm9yRWFjaCgodGFzaywgdGFza0luZGV4KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRhc2tJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuICAgICAgICAgICAgY29uc3QgdGFza0NvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHRhc2tBY3Rpb25zID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBkb25lQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IGRvbmVUYXNrQ2xhc3MgPSAndG9kby1pdGVtLWNvbXBsZXRlZCc7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlbW92ZUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xyXG5cclxuICAgICAgICAgICAgdGFza0l0ZW0uY2xhc3NMaXN0LmFkZCgndG9kby1pdGVtJyk7XHJcbiAgICAgICAgICAgIHRhc2tDb250ZW50LmNsYXNzTGlzdC5hZGQoJ3RvZG8taXRlbS1jb250ZW50Jyk7XHJcbiAgICAgICAgICAgIHRhc2tBY3Rpb25zLmNsYXNzTGlzdC5hZGQoJ3RvZG8taXRlbS1hY3Rpb25zJyk7XHJcblxyXG4gICAgICAgICAgICB0YXNrQ29udGVudC5pbm5lckhUTUwgPSB0YXNrLmNvbnRlbnQ7XHJcblxyXG4gICAgICAgICAgICBkb25lQnV0dG9uLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAndG9kby10YXNrLWJ1dHRvbiB0b2RvLWRvbmUtYnV0dG9uJylcclxuICAgICAgICAgICAgZG9uZUJ1dHRvbi5pbm5lckhUTUwgPSAnRG9uZSc7XHJcblxyXG4gICAgICAgICAgICBkb25lQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICAgICAgICAgIGUuY3VycmVudFRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0LmFkZChkb25lVGFza0NsYXNzKTtcclxuICAgICAgICAgICAgICAgIHRhc2tBY3Rpb25zLnJlbW92ZUNoaWxkKGRvbmVCdXR0b24pO1xyXG4gICAgICAgICAgICAgICAgdGFzay5pc0NvbXBsZXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFkZFRvTG9jYWxTdG9yYWdlKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZVRhc2tzTGlzdCh0aGlzLnRhc2tzKTtcclxuICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgIHJlbW92ZUJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3RvZG8tdGFzay1idXR0b24gdG9kby1yZW1vdmUtYnV0dG9uJylcclxuICAgICAgICAgICAgcmVtb3ZlQnV0dG9uLmlubmVySFRNTCA9ICdEZWxldGUnO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgcmVtb3ZlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50YXNrc0NvbnRhaW5lci5yZW1vdmVDaGlsZCh0YXNrSXRlbSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRhc2tzLnNwbGljZSh0YXNrSW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZGRUb0xvY2FsU3RvcmFnZSgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVUYXNrc0xpc3QodGhpcy50YXNrcyk7XHJcbiAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICBpZiAodGFzay5pc0NvbXBsZXRlZCkge1xyXG4gICAgICAgICAgICAgICAgdGFza0l0ZW0uY2xhc3NMaXN0LmFkZChkb25lVGFza0NsYXNzKTtcclxuICAgICAgICAgICAgICAgIHRhc2tBY3Rpb25zLmFwcGVuZChyZW1vdmVCdXR0b24pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoIXRhc2suaXNDb21wbGV0ZWQpIHtcclxuICAgICAgICAgICAgICAgIHRhc2tBY3Rpb25zLmFwcGVuZChkb25lQnV0dG9uLCByZW1vdmVCdXR0b24pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0YXNrSXRlbS5hcHBlbmQodGFza0NvbnRlbnQsIHRhc2tBY3Rpb25zKTtcclxuICAgICAgICAgICAgdGhpcy50YXNrc0NvbnRhaW5lci5hcHBlbmQodGFza0l0ZW0pO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlVGFza3NGaWx0ZXJzICgpIHtcclxuICAgICAgICBjb25zdCBzaG93QWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvZG8tc2hvdy1hbGwnKTtcclxuICAgICAgICBjb25zdCBzaG93QWN0aXZlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvZG8tc2hvdy1hY3RpdmUnKTtcclxuICAgICAgICBjb25zdCBzaG93Q29tcGxldGVkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvZG8tc2hvdy1jb21wbGV0ZWQnKTtcclxuICAgICAgICBjb25zdCBjbGVhckNvbXBsZXRlZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2RvLWNsZWFyLWNvbXBsZXRlZCcpO1xyXG5cclxuICAgICAgICBzaG93QWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZVRhc2tzTGlzdCh0aGlzLnRhc2tzKTtcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICBzaG93QWN0aXZlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZVRhc2tzTGlzdCh0aGlzLmFjdGl2ZVRhc2tzKTtcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICBzaG93Q29tcGxldGVkLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZVRhc2tzTGlzdCh0aGlzLmNvbXBsZXRlZFRhc2tzKTtcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICBjbGVhckNvbXBsZXRlZC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbXBsZXRlZFRhc2tzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb21wbGV0ZWRUYXNrcy5mb3JFYWNoKGNvbXBsZXRlZFRhc2sgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGFza3Muc3BsaWNlKHRoaXMudGFza3MuZmluZEluZGV4KHRhc2sgPT4gdGFzay5jb250ZW50ID09PSBjb21wbGV0ZWRUYXNrLmNvbnRlbnQpLCAxKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5hZGRUb0xvY2FsU3RvcmFnZSgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVUYXNrc0xpc3QodGhpcy50YXNrcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBhbGVydCgnQWxsIHRhc2tzIGhhdmUgYWN0aXZlIHN0YXR1cyEnKTtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIGFkZFRvTG9jYWxTdG9yYWdlICgpIHtcclxuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgndGFza3MnLCBKU09OLnN0cmluZ2lmeSh0aGlzLnRhc2tzKSk7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlQWN0aXZlVGFza3NDb3VudGVyICgpIHtcclxuICAgICAgICBjb25zdCBjb3VudGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvZG8tY291bnRlci1jb250ZW50Jyk7XHJcbiAgICAgICAgbGV0IGFtb3VudCA9IHRoaXMuYWN0aXZlVGFza3MubGVuZ3RoO1xyXG5cclxuICAgICAgICBzd2l0Y2ggKGFtb3VudCkge1xyXG4gICAgICAgICAgICBjYXNlIDA6XHJcbiAgICAgICAgICAgICAgICBjb3VudGVyLmlubmVySFRNTCA9ICdBbGwgdGFza3MgY29tcGxldGVkISc7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgY291bnRlci5pbm5lckhUTUwgPSBgJHthbW91bnR9IHRhc2sgbGVmdGA7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIGNvdW50ZXIuaW5uZXJIVE1MID0gYCR7YW1vdW50fSB0YXNrcyBsZWZ0YDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmNvbnN0IHRvRG9Db250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9kby1pdGVtcycpO1xyXG5jb25zdCB0b0RvTGlzdCA9IG5ldyBUb0RvTGlzdCh0b0RvQ29udGFpbmVyKTtcclxuIl19
