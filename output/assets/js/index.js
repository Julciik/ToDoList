class Task {
  constructor(content) {
    this.content = content;
    this.isCompleted = false;
  }

}

class ToDoList {
  constructor() {
    this.tasks = JSON.parse(localStorage.getItem('tasks')) || [];
    this.activeTasks = [];
    this.completedTasks = [];
    this.tasksContainer = document.getElementById('todo-items');
    this.doneTaskClass = 'todo-item-completed';
    this.init();
  }

  addTask() {
    const button = document.getElementById('todo-button-add');
    const input = document.getElementById('todo-input');
    button.addEventListener('click', () => {
      this.saveTask(input.value);
      input.value = '';
    });
  }

  saveTask(content) {
    if (content !== '') {
      const task = new Task(content);
      this.tasks.unshift(task);
      this.addToLocalStorage();
      this.renderTasks(this.tasks);
      return;
    } //TODO: add better error method


    alert('Type something!');
  }

  createTasksList(tasksArray) {
    this.tasksContainer.innerHTML = '';
    tasksArray.forEach((task, taskIndex) => {
      const taskItem = document.createElement('li');
      const taskContent = document.createElement('span');
      const taskActions = document.createElement('div');
      const doneButton = document.createElement('button');
      const removeButton = document.createElement('button');
      taskItem.classList.add('todo-item');
      taskContent.classList.add('todo-item-content');
      taskActions.classList.add('todo-item-actions');
      taskContent.innerHTML = task.content;
      doneButton.setAttribute('class', 'todo-task-button todo-done-button');
      doneButton.innerHTML = 'Done';
      doneButton.addEventListener('click', e => {
        e.currentTarget.parentNode.parentNode.classList.add(this.doneTaskClass);
        taskActions.removeChild(doneButton);
        task.isCompleted = true;
        this.addToLocalStorage();
        this.renderTasks(this.tasks);
      });
      removeButton.setAttribute('class', 'todo-task-button todo-remove-button');
      removeButton.innerHTML = 'Delete';
      removeButton.addEventListener('click', () => {
        this.tasksContainer.removeChild(taskItem);
        this.tasks.splice(taskIndex, 1);
        this.addToLocalStorage();
        this.renderTasks(this.tasks);
      });

      if (task.isCompleted) {
        taskItem.classList.add(this.doneTaskClass);
        taskActions.append(removeButton);
      }

      if (!task.isCompleted) {
        taskActions.append(doneButton, removeButton);
      }

      taskItem.append(taskContent, taskActions);
      this.tasksContainer.append(taskItem);
    });
  }

  tasksFilters() {
    const showAll = document.getElementById('todo-show-all');
    const showActive = document.getElementById('todo-show-active');
    const showCompleted = document.getElementById('todo-show-completed');
    const clearCompleted = document.getElementById('todo-clear-completed');
    showAll.addEventListener('click', e => {
      e.preventDefault();
      this.renderTasks(this.tasks);
    });
    showActive.addEventListener('click', e => {
      e.preventDefault();
      this.activeTasks = this.tasks.filter(task => task.isCompleted === false);
      this.renderTasks(activeTasks);
    });
    showCompleted.addEventListener('click', e => {
      e.preventDefault(); //TODO: Fix duplicated arrays

      this.completedTasks = this.tasks.filter(task => task.isCompleted === true);
      this.renderTasks(this.completedTasks);
    });
    clearCompleted.addEventListener('click', e => {
      e.preventDefault();
      const completedTasks = this.tasks.filter(task => task.isCompleted === true);
      const completedTaskItems = this.tasksContainer.querySelector(`.${this.doneTaskClass}`);
      completedTasks.forEach(completedTask => {
        this.tasks.splice(this.tasks.findIndex(task => task.content === completedTask.content), 1);
      });

      if (completedTaskItems) {//TODO: Remove nodes
      }

      this.addToLocalStorage();
      this.renderTasks(this.tasks);
    });
  }

  addToLocalStorage() {
    localStorage.setItem('tasks', JSON.stringify(this.tasks));
  }

  renderTasks(tasksArray) {
    this.tasksFilters();
    this.createTasksList(tasksArray);
  }

  init() {
    this.addTask();
    this.renderTasks(this.tasks);
  } //TODO: Left task counter


}

const toDoList = new ToDoList();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIlRhc2siLCJjb25zdHJ1Y3RvciIsImNvbnRlbnQiLCJpc0NvbXBsZXRlZCIsIlRvRG9MaXN0IiwidGFza3MiLCJKU09OIiwicGFyc2UiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwiYWN0aXZlVGFza3MiLCJjb21wbGV0ZWRUYXNrcyIsInRhc2tzQ29udGFpbmVyIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImRvbmVUYXNrQ2xhc3MiLCJpbml0IiwiYWRkVGFzayIsImJ1dHRvbiIsImlucHV0IiwiYWRkRXZlbnRMaXN0ZW5lciIsInNhdmVUYXNrIiwidmFsdWUiLCJ0YXNrIiwidW5zaGlmdCIsImFkZFRvTG9jYWxTdG9yYWdlIiwicmVuZGVyVGFza3MiLCJhbGVydCIsImNyZWF0ZVRhc2tzTGlzdCIsInRhc2tzQXJyYXkiLCJpbm5lckhUTUwiLCJmb3JFYWNoIiwidGFza0luZGV4IiwidGFza0l0ZW0iLCJjcmVhdGVFbGVtZW50IiwidGFza0NvbnRlbnQiLCJ0YXNrQWN0aW9ucyIsImRvbmVCdXR0b24iLCJyZW1vdmVCdXR0b24iLCJjbGFzc0xpc3QiLCJhZGQiLCJzZXRBdHRyaWJ1dGUiLCJlIiwiY3VycmVudFRhcmdldCIsInBhcmVudE5vZGUiLCJyZW1vdmVDaGlsZCIsInNwbGljZSIsImFwcGVuZCIsInRhc2tzRmlsdGVycyIsInNob3dBbGwiLCJzaG93QWN0aXZlIiwic2hvd0NvbXBsZXRlZCIsImNsZWFyQ29tcGxldGVkIiwicHJldmVudERlZmF1bHQiLCJmaWx0ZXIiLCJjb21wbGV0ZWRUYXNrSXRlbXMiLCJxdWVyeVNlbGVjdG9yIiwiY29tcGxldGVkVGFzayIsImZpbmRJbmRleCIsInNldEl0ZW0iLCJzdHJpbmdpZnkiLCJ0b0RvTGlzdCJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBQUEsSUFBQSxDQUFBO0FBQ0FDLEVBQUFBLFdBQUEsQ0FBQUMsT0FBQSxFQUFBO0FBQ0EsU0FBQUEsT0FBQSxHQUFB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QSxJQUFBO0FBQ0EsYUFBQXBELEtBQUEsQ0FBQXlDLE1BQUEsQ0FBQSxLQUFBekMsS0FBQSxDQUFBcUQsU0FBQSxDQUFBbkMsSUFBQSxJQUFBQSxJQUFBLENBQUFyQixPQUFBLEtBQUF1RCxhQUFBLENBQUF2RCxPQUFBLENBQUEsRUFBQSxDQUFBO0FBQ0EsT0FGQTs7QUFJQSxVQUFBcUQsa0JBQUEsRUFBQSxDQUNBO0FBQ0E7O0FBRUEsV0FBQTlCLGlCQUFBO0FBQ0EsV0FBQUMsV0FBQSxDQUFBLEtBQUFyQixLQUFBO0FBQ0EsS0FoQkE7QUFpQkE7O0FBRUFvQixFQUFBQSxpQkFBQSxHQUFBO0FBQ0FqQixJQUFBQSxZQUFBLENBQUFtRCxPQUFBLENBQUEsT0FBQSxFQUFBckQsSUFBQSxDQUFBc0QsU0FBQSxDQUFBLEtBQUF2RCxLQUFBLENBQUE7QUFDQTs7QUFFQXFCLEVBQUFBLFdBQUEsQ0FBQUcsVUFBQSxFQUFBO0FBQ0EsU0FBQW1CLFlBQUE7QUFDQSxTQUFBcEIsZUFBQSxDQUFBQyxVQUFBO0FBQ0E7O0FBRUFiLEVBQUFBLElBQUEsR0FBQTtBQUNBLFNBQUFDLE9BQUE7QUFDQSxTQUFBUyxXQUFBLENBQUEsS0FBQXJCLEtBQUE7QUFDQSxHQW5KQSxDQXFKQTs7O0FBckpBOztBQXdKQSxNQUFBd0QsUUFBQSxHQUFBLElBQUF6RCxRQUFBLEVBQUEiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBUYXNrIHtcclxuICAgIGNvbnN0cnVjdG9yIChjb250ZW50KSB7XHJcbiAgICAgICAgdGhpcy5jb250ZW50ID0gY29udGVudDtcclxuICAgICAgICB0aGlzLmlzQ29tcGxldGVkID0gZmFsc2U7XHJcbiAgICB9XHJcbn1cclxuXHJcbmNsYXNzIFRvRG9MaXN0IHtcclxuICAgIGNvbnN0cnVjdG9yICgpIHtcclxuICAgICAgICB0aGlzLnRhc2tzID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndGFza3MnKSkgfHwgW107XHJcbiAgICAgICAgdGhpcy5hY3RpdmVUYXNrcyA9IFtdO1xyXG4gICAgICAgIHRoaXMuY29tcGxldGVkVGFza3MgPSBbXTtcclxuICAgICAgICB0aGlzLnRhc2tzQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvZG8taXRlbXMnKTtcclxuICAgICAgICB0aGlzLmRvbmVUYXNrQ2xhc3MgPSAndG9kby1pdGVtLWNvbXBsZXRlZCc7XHJcblxyXG4gICAgICAgIHRoaXMuaW5pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZFRhc2sgKCkge1xyXG4gICAgICAgIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2RvLWJ1dHRvbi1hZGQnKTtcclxuICAgICAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2RvLWlucHV0Jyk7XHJcblxyXG4gICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zYXZlVGFzayhpbnB1dC52YWx1ZSk7XHJcbiAgICAgICAgICAgIGlucHV0LnZhbHVlID0gJyc7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICBzYXZlVGFzayAoY29udGVudCkge1xyXG4gICAgICAgIGlmIChjb250ZW50ICE9PSAnJykge1xyXG4gICAgICAgICAgICBjb25zdCB0YXNrID0gbmV3IFRhc2soY29udGVudCk7XHJcbiAgICAgICAgICAgIHRoaXMudGFza3MudW5zaGlmdCh0YXNrKTtcclxuICAgICAgICAgICAgdGhpcy5hZGRUb0xvY2FsU3RvcmFnZSgpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlclRhc2tzKHRoaXMudGFza3MpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy9UT0RPOiBhZGQgYmV0dGVyIGVycm9yIG1ldGhvZFxyXG4gICAgICAgIGFsZXJ0KCdUeXBlIHNvbWV0aGluZyEnKTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVUYXNrc0xpc3QgKHRhc2tzQXJyYXkpIHtcclxuICAgICAgICB0aGlzLnRhc2tzQ29udGFpbmVyLmlubmVySFRNTCA9ICcnO1xyXG5cclxuICAgICAgICB0YXNrc0FycmF5LmZvckVhY2goKHRhc2ssIHRhc2tJbmRleCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB0YXNrSXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHRhc2tDb250ZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xyXG4gICAgICAgICAgICBjb25zdCB0YXNrQWN0aW9ucyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgZG9uZUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xyXG4gICAgICAgICAgICBjb25zdCByZW1vdmVCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcclxuXHJcbiAgICAgICAgICAgIHRhc2tJdGVtLmNsYXNzTGlzdC5hZGQoJ3RvZG8taXRlbScpO1xyXG4gICAgICAgICAgICB0YXNrQ29udGVudC5jbGFzc0xpc3QuYWRkKCd0b2RvLWl0ZW0tY29udGVudCcpO1xyXG4gICAgICAgICAgICB0YXNrQWN0aW9ucy5jbGFzc0xpc3QuYWRkKCd0b2RvLWl0ZW0tYWN0aW9ucycpO1xyXG5cclxuICAgICAgICAgICAgdGFza0NvbnRlbnQuaW5uZXJIVE1MID0gdGFzay5jb250ZW50O1xyXG5cclxuICAgICAgICAgICAgZG9uZUJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3RvZG8tdGFzay1idXR0b24gdG9kby1kb25lLWJ1dHRvbicpXHJcbiAgICAgICAgICAgIGRvbmVCdXR0b24uaW5uZXJIVE1MID0gJ0RvbmUnO1xyXG5cclxuICAgICAgICAgICAgZG9uZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBlLmN1cnJlbnRUYXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQodGhpcy5kb25lVGFza0NsYXNzKTtcclxuICAgICAgICAgICAgICAgIHRhc2tBY3Rpb25zLnJlbW92ZUNoaWxkKGRvbmVCdXR0b24pO1xyXG4gICAgICAgICAgICAgICAgdGFzay5pc0NvbXBsZXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFkZFRvTG9jYWxTdG9yYWdlKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlclRhc2tzKHRoaXMudGFza3MpO1xyXG4gICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgcmVtb3ZlQnV0dG9uLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAndG9kby10YXNrLWJ1dHRvbiB0b2RvLXJlbW92ZS1idXR0b24nKVxyXG4gICAgICAgICAgICByZW1vdmVCdXR0b24uaW5uZXJIVE1MID0gJ0RlbGV0ZSc7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICByZW1vdmVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRhc2tzQ29udGFpbmVyLnJlbW92ZUNoaWxkKHRhc2tJdGVtKTtcclxuICAgICAgICAgICAgICAgIHRoaXMudGFza3Muc3BsaWNlKHRhc2tJbmRleCwgMSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFkZFRvTG9jYWxTdG9yYWdlKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlclRhc2tzKHRoaXMudGFza3MpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgIGlmICh0YXNrLmlzQ29tcGxldGVkKSB7XHJcbiAgICAgICAgICAgICAgICB0YXNrSXRlbS5jbGFzc0xpc3QuYWRkKHRoaXMuZG9uZVRhc2tDbGFzcyk7XHJcbiAgICAgICAgICAgICAgICB0YXNrQWN0aW9ucy5hcHBlbmQocmVtb3ZlQnV0dG9uKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCF0YXNrLmlzQ29tcGxldGVkKSB7XHJcbiAgICAgICAgICAgICAgICB0YXNrQWN0aW9ucy5hcHBlbmQoZG9uZUJ1dHRvbiwgcmVtb3ZlQnV0dG9uKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGFza0l0ZW0uYXBwZW5kKHRhc2tDb250ZW50LCB0YXNrQWN0aW9ucyk7XHJcbiAgICAgICAgICAgIHRoaXMudGFza3NDb250YWluZXIuYXBwZW5kKHRhc2tJdGVtKTtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIHRhc2tzRmlsdGVycyAoKSB7XHJcbiAgICAgICAgY29uc3Qgc2hvd0FsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2RvLXNob3ctYWxsJyk7XHJcbiAgICAgICAgY29uc3Qgc2hvd0FjdGl2ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2RvLXNob3ctYWN0aXZlJyk7XHJcbiAgICAgICAgY29uc3Qgc2hvd0NvbXBsZXRlZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2RvLXNob3ctY29tcGxldGVkJyk7XHJcbiAgICAgICAgY29uc3QgY2xlYXJDb21wbGV0ZWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9kby1jbGVhci1jb21wbGV0ZWQnKTtcclxuXHJcbiAgICAgICAgc2hvd0FsbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyVGFza3ModGhpcy50YXNrcyk7XHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgc2hvd0FjdGl2ZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICBcclxuICAgICAgICAgICAgdGhpcy5hY3RpdmVUYXNrcyA9IHRoaXMudGFza3MuZmlsdGVyKCh0YXNrKSA9PiB0YXNrLmlzQ29tcGxldGVkID09PSBmYWxzZSk7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyVGFza3MoYWN0aXZlVGFza3MpO1xyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIHNob3dDb21wbGV0ZWQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgICAgICAvL1RPRE86IEZpeCBkdXBsaWNhdGVkIGFycmF5c1xyXG5cclxuICAgICAgICAgICAgdGhpcy5jb21wbGV0ZWRUYXNrcyA9IHRoaXMudGFza3MuZmlsdGVyKCh0YXNrKSA9PiB0YXNrLmlzQ29tcGxldGVkID09PSB0cnVlKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJUYXNrcyh0aGlzLmNvbXBsZXRlZFRhc2tzKTtcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICBjbGVhckNvbXBsZXRlZC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRlZFRhc2tzID0gdGhpcy50YXNrcy5maWx0ZXIoKHRhc2spID0+IHRhc2suaXNDb21wbGV0ZWQgPT09IHRydWUpO1xyXG4gICAgICAgICAgICBjb25zdCBjb21wbGV0ZWRUYXNrSXRlbXMgPSB0aGlzLnRhc2tzQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoYC4keyB0aGlzLmRvbmVUYXNrQ2xhc3MgfWApO1xyXG5cclxuICAgICAgICAgICAgY29tcGxldGVkVGFza3MuZm9yRWFjaChjb21wbGV0ZWRUYXNrID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGFza3Muc3BsaWNlKHRoaXMudGFza3MuZmluZEluZGV4KHRhc2sgPT4gdGFzay5jb250ZW50ID09PSBjb21wbGV0ZWRUYXNrLmNvbnRlbnQpLCAxKTtcclxuICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgIGlmIChjb21wbGV0ZWRUYXNrSXRlbXMpIHtcclxuICAgICAgICAgICAgICAgIC8vVE9ETzogUmVtb3ZlIG5vZGVzXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuYWRkVG9Mb2NhbFN0b3JhZ2UoKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJUYXNrcyh0aGlzLnRhc2tzKTtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIGFkZFRvTG9jYWxTdG9yYWdlICgpIHtcclxuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgndGFza3MnLCBKU09OLnN0cmluZ2lmeSh0aGlzLnRhc2tzKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVuZGVyVGFza3MgKHRhc2tzQXJyYXkpIHtcclxuICAgICAgICB0aGlzLnRhc2tzRmlsdGVycygpO1xyXG4gICAgICAgIHRoaXMuY3JlYXRlVGFza3NMaXN0KHRhc2tzQXJyYXkpO1xyXG4gICAgfVxyXG5cclxuICAgIGluaXQgKCkge1xyXG4gICAgICAgIHRoaXMuYWRkVGFzaygpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyVGFza3ModGhpcy50YXNrcyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy9UT0RPOiBMZWZ0IHRhc2sgY291bnRlclxyXG59XHJcblxyXG5jb25zdCB0b0RvTGlzdCA9IG5ldyBUb0RvTGlzdCgpO1xyXG4iXX0=
